<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AA - AykolinoApps - HTML Translator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .loader {
            border-top-color: #3b82f6;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .drag-over {
            border-color: #ec4899; /* pink-500 */
            box-shadow: 0 0 15px rgba(236, 72, 153, 0.5);
        }
        /* Custom scrollbar for webkit browsers */
        textarea::-webkit-scrollbar,
        pre::-webkit-scrollbar {
            width: 8px;
        }
        textarea::-webkit-scrollbar-track,
        pre::-webkit-scrollbar-track {
            background: #1f2937;
        }
        textarea::-webkit-scrollbar-thumb,
        pre::-webkit-scrollbar-thumb {
            background-color: #4b5563;
            border-radius: 4px;
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-300 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-6xl mx-auto">
        <div class="bg-slate-800 rounded-xl shadow-2xl p-6 sm:p-8 border border-slate-700">
            <header class="text-center mb-8">
                <h1 class="text-3xl sm:text-4xl font-bold text-white">HTML Translator Pro</h1>
                <p class="text-slate-400 mt-2">HTML-Struktur bleibt garantiert erhalten - nur der Text wird übersetzt.</p>
            </header>

            <main>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-8">
                    <!-- Input Section -->
                    <div class="flex flex-col">
                        <label for="html-input" class="text-lg font-semibold mb-3 text-white">Original-Code</label>
                        <div id="drop-zone" class="relative w-full h-96 flex-grow bg-slate-900 text-slate-300 border-2 border-dashed border-slate-600 rounded-lg p-4 transition-all duration-300">
                            <textarea id="html-input" class="absolute inset-0 w-full h-full bg-transparent text-slate-300 border-none rounded-lg p-4 focus:outline-none resize-none" placeholder="HTML-Datei hierher ziehen oder Code einfügen..."></textarea>
                            <div class="absolute inset-0 flex items-center justify-center text-slate-500 pointer-events-none">
                               <span>HTML-Datei hierher ziehen oder Code einfügen</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Output Section -->
                    <div class="flex flex-col">
                        <label for="html-output" class="text-lg font-semibold mb-3 text-white">Übersetzter Code</label>
                        <div id="output-container" class="relative w-full h-96 flex-grow bg-slate-900 border-2 border-slate-700 rounded-lg">
                            <pre class="w-full h-full overflow-auto"><code id="html-output" class="language-html whitespace-pre-wrap p-4 block"></code></pre>
                            <div id="loader" class="absolute inset-0 bg-slate-900 bg-opacity-75 flex items-center justify-center hidden rounded-lg">
                                <div class="loader ease-linear rounded-full border-8 border-t-8 border-slate-600 h-20 w-20"></div>
                            </div>
                            <button id="copy-btn" class="absolute top-2 right-2 bg-slate-700 hover:bg-slate-600 text-white font-semibold py-1 px-3 rounded-md transition duration-200 opacity-50 hover:opacity-100">Kopieren</button>
                        </div>
                    </div>
                </div>

                <!-- Controls Section -->
                <div class="mt-8 flex flex-col sm:flex-row items-center justify-between gap-4">
                    <select id="language-select" class="w-full sm:w-64 bg-slate-700 text-white border-2 border-slate-600 rounded-lg py-3 px-4 focus:outline-none focus:ring-2 focus:ring-pink-500 transition duration-200">
                        <option value="de">Deutsch</option>
                        <option value="en">Englisch</option>
                        <option value="fr">Französisch</option>
                        <option value="it">Italienisch</option>
                        <option value="es">Spanisch</option>
                    </select>
                    <div class="flex flex-col sm:flex-row items-center gap-4 w-full sm:w-auto">
                        <button id="translate-btn" class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg transition duration-200 transform hover:scale-105 shadow-lg">
                            Übersetzen
                        </button>
                        <button id="download-btn" class="w-full sm:w-auto bg-pink-600 hover:bg-pink-700 text-white font-bold py-3 px-8 rounded-lg transition duration-200 transform hover:scale-105 shadow-lg flex items-center justify-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                            Download
                        </button>
                    </div>
                </div>
                 <!-- Error Message Display -->
                <div id="error-message" class="mt-4 text-center text-red-400 font-semibold hidden min-h-[1.5rem]"></div>
            </main>
        </div>
        <footer class="mt-6 text-slate-500 text-sm flex justify-between items-center px-2">
            <div>Version 1.01</div>
            <div>©AykolinoApps</div>
        </footer>
    </div>

    <script>
        const dropZone = document.getElementById('drop-zone');
        const htmlInput = document.getElementById('html-input');
        const htmlOutput = document.getElementById('html-output');
        const languageSelect = document.getElementById('language-select');
        const translateBtn = document.getElementById('translate-btn');
        const downloadBtn = document.getElementById('download-btn');
        const loader = document.getElementById('loader');
        const errorMessage = document.getElementById('error-message');
        const copyBtn = document.getElementById('copy-btn');
        const dropZonePlaceholder = dropZone.querySelector('span');

        // --- Drag & Drop Logic ---
        dropZone.addEventListener('dragenter', (e) => { e.preventDefault(); dropZone.classList.add('drag-over'); });
        dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('drag-over'); });
        dropZone.addEventListener('dragleave', (e) => { e.preventDefault(); dropZone.classList.remove('drag-over'); });
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('drag-over');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                if (file.type === "text/html") {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        htmlInput.value = event.target.result;
                        updatePlaceholder();
                        hideError();
                    };
                    reader.readAsText(file);
                } else {
                    showError("Bitte nur .html-Dateien ablegen.");
                }
            }
        });
        
        htmlInput.addEventListener('input', updatePlaceholder);

        function updatePlaceholder() {
             dropZonePlaceholder.style.display = htmlInput.value.length > 0 ? 'none' : 'flex';
        }
        updatePlaceholder();

        // --- Translation Logic ---
        translateBtn.addEventListener('click', handleTranslation);

async function handleTranslation() {
    const htmlString = htmlInput.value;
    const targetLanguage = languageSelect.value;
    if (!htmlString.trim()) {
        showError("Bitte geben Sie HTML-Code ein oder ziehen Sie eine Datei per Drag & Drop.");
        return;
    }

    loader.classList.remove('hidden');
    htmlOutput.textContent = '';
    hideError();

    try {
        // Create a temporary container to parse the HTML fragment
        const tempContainer = document.createElement('div');
        tempContainer.innerHTML = htmlString;

        const textNodes = [];
        const textsToTranslate = [];
        
        // The walk function remains the same
        function walk(node) {
            if (node.nodeType === 3) { // Text node
                const text = node.nodeValue.trim();
                if (text.length > 0 && node.parentElement.nodeName !== 'SCRIPT' && node.parentElement.nodeName !== 'STYLE') {
                    textNodes.push(node);
                    textsToTranslate.push(text);
                }
            } else if (node.nodeType === 1) { // Element node
                for (let i = 0; i < node.childNodes.length; i++) {
                    walk(node.childNodes[i]);
                }
            }
        }

        // Start walking from our temporary container
        walk(tempContainer);

        if (textsToTranslate.length === 0) {
            htmlOutput.textContent = htmlString;
            loader.classList.add('hidden');
            return;
        }

        const translationPromises = textsToTranslate.map(text => translateText(text, targetLanguage));
        const translatedTexts = await Promise.all(translationPromises);
        
        textNodes.forEach((node, index) => {
            const originalText = node.nodeValue;
            const trimmedOriginal = originalText.trim();
            const translatedText = translatedTexts[index] || '';
            // Use a regex with a global flag to replace all occurrences if needed,
            // though for text nodes this is usually safe.
            node.nodeValue = originalText.replace(trimmedOriginal, translatedText);
        });

        // Get the HTML from the container, which does NOT include the container itself
        const finalHtml = tempContainer.innerHTML;
        htmlOutput.textContent = finalHtml;

    } catch (error) {
        console.error('Übersetzung fehlgeschlagen:', error);
        showError("Übersetzung fehlgeschlagen: " + error.message);
        htmlOutput.textContent = htmlString; // Show original on failure
    } finally {
        loader.classList.add('hidden');
    }
}

        async function translateText(text, targetLang) {
            // Switched to a more reliable public API endpoint that properly handles auto-detection.
            const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${targetLang}&dt=t&q=${encodeURIComponent(text)}`;
            
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`Netzwerkantwort war nicht ok: ${response.statusText}`);
                }
                const data = await response.json();
                
                // The response is a nested array. The translated text is in the first element.
                if (data && data[0] && data[0][0] && data[0][0][0]) {
                    // Sometimes the API returns multiple segments, join them.
                    let translatedText = '';
                    data[0].forEach(segment => {
                        if (segment[0]) {
                            translatedText += segment[0];
                        }
                    });
                    return translatedText;
                } else {
                    console.warn('Übersetzungs-Snippet fehlgeschlagen, Original wird zurückgegeben:', data);
                    return text; // Return original text if translation is not found
                }
            } catch (error) {
                 console.error('API-Aufruf für Snippet fehlgeschlagen:', text, error);
                 // On error, return original text to avoid breaking the document structure.
                 return text;
            }
        }

        // --- UI Helper Functions ---
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.remove('hidden');
        }
        function hideError() {
            errorMessage.textContent = '';
            errorMessage.classList.add('hidden');
        }

        copyBtn.addEventListener('click', () => {
            const content = htmlOutput.textContent;
            if (!content || !content.trim()) {
                showError('Es gibt nichts zu kopieren.');
                return;
            }
            const textArea = document.createElement('textarea');
            textArea.value = content;
            textArea.style.position = 'fixed';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    copyBtn.textContent = 'Kopiert!';
                    setTimeout(() => { copyBtn.textContent = 'Kopieren'; }, 2000);
                } else {
                    showError('Kopieren fehlgeschlagen.');
                }
            } catch (err) {
                showError('Kopieren fehlgeschlagen: ' + err);
            }
            document.body.removeChild(textArea);
        });
        
        downloadBtn.addEventListener('click', () => {
            const content = htmlOutput.textContent;
            if (!content || !content.trim()) {
                showError("Es gibt nichts zum Herunterladen.");
                return;
            }
            try {
                const blob = new Blob([content], { type: 'text/html;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = 'translated.html';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            } catch (error) {
                showError("Download fehlgeschlagen: " + error.message);
                console.error("Download-Fehler:", error);
            }
        }); // Marquee Title Effect
        (function() {
            const originalTitle = document.title + " ";
            let titleText = originalTitle;
            function marquee() {
                titleText = titleText.substring(1, titleText.length) + titleText.substring(0, 1);
                document.title = titleText;
            }
            setInterval(marquee, 300); // Speed in milliseconds
        })();
    </script>
</body>
</html>

